-- schema.sql
PRAGMA foreign_keys = ON;

CREATE TABLE IF NOT EXISTS Product (
  ProductID INTEGER PRIMARY KEY AUTOINCREMENT,
  Name TEXT NOT NULL,
  Type TEXT NOT NULL,
  ProduceYear INTEGER NOT NULL,
  Price REAL NOT NULL,
  Total INTEGER NOT NULL,
  Model TEXT,
  Cpu TEXT NOT NULL,
  Gpu TEXT NOT NULL,
  Motherboard TEXT NOT NULL,
  Ram TEXT NOT NULL,
  Description TEXT
);

CREATE TABLE IF NOT EXISTS Admin (
  AdminID INTEGER PRIMARY KEY AUTOINCREMENT,
  Username TEXT NOT NULL UNIQUE,
  Password TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS ShoppingCart (
  CartID INTEGER PRIMARY KEY AUTOINCREMENT,
  SessionID TEXT NOT NULL,
  CreatedAt TEXT DEFAULT (datetime('now'))
);

CREATE TABLE IF NOT EXISTS CartItems (
  CartItemID INTEGER PRIMARY KEY AUTOINCREMENT,
  CartID INTEGER NOT NULL,
  ProductID INTEGER NOT NULL,
  Quantity INTEGER NOT NULL,
  FOREIGN KEY (CartID) REFERENCES ShoppingCart(CartID) ON DELETE CASCADE,
  FOREIGN KEY (ProductID) REFERENCES Product(ProductID) ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS Orders (
  OrderID INTEGER PRIMARY KEY AUTOINCREMENT,
  CustomerName TEXT NOT NULL,
  CustomerPhone TEXT NOT NULL,
  CustomerAddress TEXT NOT NULL,
  OrderDate TEXT DEFAULT (datetime('now')),
  TotalAmount REAL NOT NULL,
  Status TEXT DEFAULT 'PENDING'
);

CREATE TABLE IF NOT EXISTS OrderItems (
  OrderItemID INTEGER PRIMARY KEY AUTOINCREMENT,
  OrderID INTEGER NOT NULL,
  ProductID INTEGER NOT NULL,
  Quantity INTEGER NOT NULL,
  Price REAL NOT NULL,
  FOREIGN KEY (OrderID) REFERENCES Orders(OrderID) ON DELETE CASCADE,
  FOREIGN KEY (ProductID) REFERENCES Product(ProductID) ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS PaymentStatus (
  PaymentID INTEGER PRIMARY KEY AUTOINCREMENT,
  OrderID INTEGER NOT NULL,
  Status TEXT NOT NULL,
  BankRef TEXT,
  PaidAt TEXT,
  AdminApproved INTEGER DEFAULT 0,
  FOREIGN KEY (OrderID) REFERENCES Orders(OrderID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS ProductImages (
  ImageID INTEGER PRIMARY KEY AUTOINCREMENT,
  ProductID INTEGER NOT NULL,
  ImageURL TEXT NOT NULL,
  AltText TEXT,
  FOREIGN KEY (ProductID) REFERENCES Product(ProductID) ON DELETE CASCADE
);

CREATE INDEX IF NOT EXISTS idx_cart_session ON ShoppingCart(SessionID);
CREATE INDEX IF NOT EXISTS idx_order_date ON Orders(OrderDate);
CREATE INDEX IF NOT EXISTS idx_payment_order ON PaymentStatus(OrderID);
CREATE INDEX IF NOT EXISTS idx_orderitems_order ON OrderItems(OrderID);
